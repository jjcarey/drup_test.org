(function(e){Drupal.behaviors.valet={dataLabel:parseFloat(e.ui.version)==1.8?"autocomplete":"ui-Autocomplete",dataItemLabel:parseFloat(e.ui.version)==1.8?"item.autocomplete":"ui-autocomplete-item",once:false,open:false,links:false,results:false,weight:false,selected:false,requestTerm:"",valetSelector:"",valetSearchSelector:"",shifted:false,attach:function(t,n){var r=this;if(r.once)return;r.once=true;r.valetSelector=e("#valet");if(!r.valetSelector.length)return;r.valetSearchSelector=e("#valet-search");r.valetSelector.hide();if(!Drupal.settings.valet.purge){Lawnchair({name:"valet"},function(){this.get("links",function(e){r.links=e!="undefined"?e:false});this.get("weight",function(e){r.weights=e!="undefined"?e:false})})}if(!r.links){e.ajax({url:Drupal.settings.basePath+"admin/valet/lookup",dataType:"json",success:function(e){Lawnchair({name:"valet"},function(){this.remove("links");this.save(e);r.links=e})},error:function(e,t,n){alert(e.status);alert(n)}})}r.valetSearchSelector.autocomplete({minLength:2,delay:0,autoFocus:true,appendTo:"#valet-results",source:function(e,t){r.resultsFilter(e.term);t(r.results)},focus:function(e,t){r.selected=t.item;r.childrenCheck();return false},select:function(e,t){if(t.item){r.go(t.item.label,t.item.value);return false}},open:function(t,n){var i=e(this).data(Drupal.behaviors.valet.dataLabel);menu=i.menu;if(menu.activate){menu.activate(e.Event({type:"mouseenter"}),menu.element.children().first())}if(!this.shiftSet){this.shiftSet=true;e(this).bind("keydown","shift",function(){r.shifted=true}).bind("keyup","shift",function(){r.shifted=false})}}}).data(Drupal.behaviors.valet.dataLabel)._renderItem=function(t,n){var i=r.shortcut(n.value);var s=r.children(n);var o=n.value.length>85?n.value.substring(0,85)+"...":n.value.length>0?n.value:"/";return e("<li></li>").data(Drupal.behaviors.valet.dataItemLabel,n).append("<a><strong>"+n.label+"</strong><br><em>"+o+"</em>"+s+i+"</a>").appendTo(t)};e(document).bind("keydown",Drupal.settings.valet.modifier+"+"+Drupal.settings.valet.key,function(){r.show();return false});e(document).bind("keydown","esc",function(){r.hide()});r.valetSearchSelector.bind("keydown","esc",function(){r.hide()});r.valetSearchSelector.bind("keydown",Drupal.settings.valet.modifier,function(){r.childrenCreate();return false});e(document).click(function(){r.hide()});e("#valet-search-form").submit(function(){return false})},resultsFilter:function(t){var n=this;n.requestTerm=t;if(!n.links){console.log("Valet Links Not Found!");return}var r=e.ui.autocomplete.filter(n.links.items,n.requestTerm);n.results=r.slice(0,4);if(n.weights&&n.weights[n.requestTerm]){var i=n.weights[n.requestTerm];for(var s=0;s<n.results.length;s++){if(i[n.results[s].value]){n.results[s].weight=i[n.results[s].value]}else{n.results[s].weight=0}}}n.results.sort(n.weightSort)},go:function(t,n){var r=this;r.goSave(n);if(n=="devel/cache/clear")n="devel/cache/clear?destination="+window.location.pathname.substring(1);if(n=="devel/ambit/clear")n="devel/ambit/clear?destination="+window.location.pathname.substring(1);if(n.indexOf("valet/cache/clear")!=-1)n+="?destination="+window.location.pathname.substring(1);var i=t.replace(/<\/?[a-z][a-z0-9]*[^<>]*>/ig,"");i=i.length>28?i.substring(0,28)+"...":i;var s=n.length>40?n.substring(0,40)+"...":n.length>0?n:"/";e("#valet-results").hide();r.valetSelector.addClass("loading");e("#valet-loading-info").text(i);e("#valet-loading-value span").text(s);if(r.shifted){r.hide();window.open(Drupal.settings.basePath+n)}else{window.location=Drupal.settings.basePath+n}},goSave:function(e){var t=this;Lawnchair({name:"valet"},function(){var t=this;this.get("weight",function(n){if(!n){n={key:"weight"}}if(!n[t.requestTerm]){n[t.requestTerm]={}}n[t.requestTerm][e]=n[t.requestTerm][e]?n[t.requestTerm][e]+1:1;this.save(n)})})},show:function(){var e=this;e.open=true;e.valetSelector.fadeIn("normal");e.valetSearchSelector.focus().data(Drupal.behaviors.valet.dataLabel)._trigger("change")},hide:function(){var t=this;t.open=false;t.valetSelector.fadeOut("fast");t.valetSearchSelector.unbind("keydown","1");t.valetSearchSelector.unbind("keydown","2");t.valetSearchSelector.unbind("keydown","3");e("#valet-results").show();t.valetSelector.removeClass("loading");e("#valet-loading-info").text("");e("#valet-loading-value span").text("")},children:function(e){var t=this;if(e.children){return'<span class="valet-icon valet-icon-'+Drupal.settings.valet.modifier.toLowerCase()+'"></span>'}return""},childrenCheck:function(e){var t=this;var e=t.selected;t.childrenRemove()},childrenCreate:function(){var t=this;var n=t.selected;if(n.children&&!n.child){if(e(".valet-child").length)return;var r=e("#ui-active-menuitem").parent();for(var i=0;i<n.children.length;i++){var s=n.children[i];s.child=true;s.weight=i;var o="";if(i==0)o+=" first";if(i==n.children.length-1)o+=" last";var u=e('<li class="ui-menu-item valet-child'+o+'" role="menuitem"></li>').data("item.autocomplete",s).append("<a>"+s.label+"</a>");r.after(u);r=u;var a=u.height();u.css({height:0}).animate({height:a},300)}}},childrenRemove:function(){var t=this;var n=t.selected;var r=e(".valet-child");if(!n.child&&r.length){r.animate({height:0},300,function(){e(this).remove()})}},shortcut:function(e){var t=this;var n="";switch(e){case t.results[0]["value"]:n="return";break;case t.results[1]["value"]:n="1";break;case t.results[2]["value"]:n="2";break;case t.results[3]["value"]:n="3";break}var r=parseInt(n);if(r){t.valetSearchSelector.unbind("keydown",n);t.valetSearchSelector.bind("keydown",n,function(){t.go(t.results[r]["label"],t.results[r]["value"])})}return n?'<span class="valet-icon valet-icon-'+n+'"><span>':""},weightSort:function(t,n){var r=this;if(t.weight>n.weight)return-1;if(t.weight<n.weight)return 1;return 0}}})(jQuery)
